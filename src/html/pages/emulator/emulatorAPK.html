<html data-theme="dark" lang="en-us">
<script src="../../../../dist/js/pages/emulator/emulatorPageAPK.js"></script>
<script src="https://pygame-web.github.io/archives/0.2.0/pythons.js" type=module id="main" data-src="fs,snd,gui" async defer>#<!--

import sys
import asyncio
import platform
import json
from pathlib import Path

# screen pixels (real, hardware)
WIDTH=1024  # {{cookiecutter.width}}
HEIGHT=600  # {{cookiecutter.height}}

# reference/idealized screen pixels
REFX = 1980
REFY = 1080

def u(real, ref, v):
    if abs(v)<0.9999999:
        result = int( (float(real)/100.0) * (v*1000))
        if v<0:
            return real-result
        return result
    return int( (real/ref) * v )

def ux(*argv):
    global WIDTH, REFX
    acc = 0
    for v in argv:
        acc += u(WIDTH, REFX, v)
    return acc

def uy(*argv):
    global HEIGHT, REFY
    acc = 0
    for v in argv:
        acc += u(HEIGHT, REFY, v)
    return acc

# don't rename
async def sitecustomize():
    import embed

    import pygame

    def compose():
        pygame.display.update()

    pygame.init()
    pygame.font.init()

    screen = pygame.display.set_mode([ux(.100),uy(.100)], pygame.SRCALPHA, 32)

    compose()



    apk = "https://raw.githubusercontent.com/TinyCircuits/TinyCircuits-Thumby-Games/master/APKS/building.apk"

    bundle = "building"

    # the C or js loader could do that but be explicit.
    appdir = Path(f"/data/data/{bundle}") # /data/data/building
    appdir.mkdir()


    # mount apk

    cfg = {
        "io": "url",
        "type":"mount",
        "mount" : {
            "point" : appdir.as_posix(),
            "path" : "/",
        }

    }

    track = platform.window.MM.prepare(apk, json.dumps(cfg))

    def pg_bar(pos):
        pass

    # wait until zip mount + overlayfs is complete
    while not track.ready:
        pg_bar(track.pos)
        compose()
        await asyncio.sleep(.1)

    # fill it up in case it was cached and instant download
    pg_bar(track.len)
    compose()


    # preloader will change dir and prepend it to sys.path
    platform.run_main(PyConfig, loaderhome= appdir / "assets", loadermain=None)


    # wait preloading complete
    # that includes images and wasm compilation of bundled modules
    while embed.counter()<0:
        await asyncio.sleep(.1)

    main = appdir / "assets" / "main.py"


    print("145: running main and resuming EventTarget in a few seconds")
    execfile(main)

    # if you don't reach that step
    # your main.py has an infinite sync loop somewhere !
    print("150: ready")

    platform.window.main()


    # makes all queued events arrive after program has looped a few cycles
    while not aio.run_called:
        await asyncio.sleep(.1)

    aio.create_task(platform.EventTarget.process())



asyncio.run( sitecustomize() )












# BEGIN BLOCK
#
# now this is the html part you can (and should) customize
# It is not mandatory : pygame-script when it reads the first line (also called
# shebang ) of above code create absolute minimal widget set
# required for running with default rules
#
# do not alter that comment block it is separating python code from html code
# =============================================================================
# --></script><head><!--
//=============================================================================
//
//
//
//
//
//
//

    {%- if cookiecutter.comment != "" -%}
{{cookiecutter.comment}}
    {% endif %}

--><script type="application/javascript">
// END BLOCK



// this dict is available under PyConfig.config from __main__
</script>

    <title>Thumby Arcade</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">


    <link href="/dist/tailwind_output.css" rel="stylesheet">
    <link rel="icon" type="image/png" href="favicon.png" sizes="16x16">

    <style>
        /* Hide "Downloading" and "Running" elements added by pygbag and pythons.js */
        /* .emscripten{
            visibility: hidden;
        } */

        .canvas {
            border: 0px none;
            background-color: transparent;
            width: 100%;
            height: 100%;
            z-index: 5;

            padding: 0;
            margin: 0 auto;

            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;

            visibility: hidden;
        }
    </style>

    <script src="https://pygame-web.github.io/archives/0.2.0//browserfs.min.js"></script>

</head>

<body>
    <canvas class="canvas" id="canvas" width="1px" height="1px" oncontextmenu="event.preventDefault()" tabindex=1> </canvas>


    <svg id="thumbyIcon" viewBox="0 0 723.19 1182.1" xmlns="http://www.w3.org/2000/svg" class="absolute left-0 right-0 top-0 bottom-0 m-auto w-1/12">
        <g id="Page" transform="translate(-1123.6 -458.95)" fill="none" fill-rule="evenodd" stroke="#fff" stroke-linejoin="bevel">
            <g transform="translate(1485,1050)" stroke-linecap="round" stroke-width="10.0">
                <path d="m48.437 409.26-10.16 2.722m-101.6-2.722-10.16 2.722m25.035-58.238 10.16-2.722m101.6 2.722 10.16-2.722m-282.27-940.64h137.16m-147.32-.177c3.3867.059 6.7733.118 10.16.177m137.16 0c3.2011-.0557 6.4022-.11133 9.6033-.167m-9.6033.167v.515m10.16-.692h382.02m39.618 39.618c.45875-21.274-18.336-40.076-39.618-39.618m39.618 39.618v1020.1m-119.87 119.89h-.018m119.89-119.89v.018m-680.73-1059.7c-21.274-.46005-40.076 18.336-39.618 39.618m39.618-39.618h101.61v.101m155.63 998.95-10.16 2.722m25.035-58.238 10.16-2.722m86.725 58.238-10.16 2.722m25.035-58.238 10.16-2.722m-45.355 23.042c11.732-6.7733 23.464-13.547 35.195-20.32m20.32 35.196c-11.732 6.7733-23.464 13.547-35.195 20.32m-132.08-35.196c11.732-6.7733 23.464-13.547 35.195-20.32m20.32 35.196c-11.732 6.7733-23.464 13.547-35.195 20.32m-136.83-845.64v289.56h400.3v-289.56h-400.3m-20.32 386.08h401.32m-440.94-39.624c-.48384 21.27 18.347 40.106 39.624 39.624m-39.624-400.3v360.68m39.624-400.3c-21.27-.48389-40.106 18.347-39.624 39.624m480.57-39.624h-440.94m480.57 39.624c.48389-21.27-18.347-40.106-39.624-39.624m39.624 360.68v-321.06m-79.248 400.3c42.607.9072 80.151-36.611 79.248-79.248m-322.07-460.25c-.90584.18082-3.2169.64216-3.4666.692m305.22 639.39c-51.334-2.7991-80.649 68.016-42.387 102.33 11.071 11.169 26.654 17.644 42.387 17.557m-119.89-40.64c-51.334-2.7992-80.649 68.016-42.387 102.33 11.071 11.169 26.654 17.644 42.387 17.557m-331.22-139.19h-69.596c-5.4418-.1369-10.297 4.7182-10.16 10.16v83.312c-.1369 5.4418 4.7182 10.297 10.16 10.16h69.596v69.596c-.1369 5.4418 4.7182 10.297 10.16 10.16h83.312c5.4418.1369 10.297-4.7182 10.16-10.16v-69.596h69.596c5.4418.13696 10.297-4.7182 10.16-10.16v-83.312c.13694-5.4418-4.7182-10.297-10.16-10.16h-69.596m0-69.596c.13696-5.4418-4.7182-10.297-10.16-10.16m-83.312 0c-5.4418-.13694-10.297 4.7182-10.16 10.16m93.472-10.16h-83.312m-18.288-620.27h-101.1m-39.618 39.618c-.46005-21.274 18.336-40.076 39.618-39.618m-39.618 39.618v1100.3m39.618 39.618c-21.274.45875-40.076-18.336-39.618-39.618m720.34-80.252c1.2853 64.496-55.321 121.15-119.87 119.87m119.87-119.87v-1020.1m-39.618-39.618c21.275-.46012 40.075 18.336 39.618 39.618m-39.618-39.618h-382.53m163.65 1178.7c7.1842.00058 14.369.0387 21.552.156m-21.552-.156h-203.35m-21.552.156c7.1834-.11728 14.368-.15541 21.552-.156m-21.552.156c-14.635.25533-29.27.51067-43.905.766m-153.42 0h153.42m334.26 0h73.17m-73.17 0c-14.635-.25533-29.27-.51067-43.905-.766m-230.92-478.79v-69.596m-103.63 0v69.596m284.81 240.79c20.301-.66025 28.074 28.307 10.16 37.918m-45.355 23.042c-20.301.66037-28.075-28.307-10.16-37.918m-66.405-23.042c20.301-.66025 28.074 28.307 10.16 37.918m-45.355 23.042c-20.301.66037-28.075-28.307-10.16-37.918m323.41-203.89c51.334 2.799 80.649-68.016 42.387-102.33-11.071-11.169-26.654-17.644-42.387-17.557m-119.89 199.14c51.334 2.799 80.649-68.016 42.387-102.33-11.071-11.169-26.654-17.644-42.387-17.557m120.38 380.59c52.663.0567 52.922-80.318 0-80.5-52.663-.0578-52.921 80.318 0 80.5"/>
            </g>
        </g>
    </svg>


    <!-- The button to open modal -->
    <label id="btnOpenArcade" for="my-modal" class="btn modal-button invisible">open arcade</label>

    <!-- Put this part before </body> tag -->
    <input type="checkbox" id="my-modal" class="modal-toggle" />
        <div class="modal">
            <div class="modal-box p-0  tiny:min-w-[320px]  sm:min-w-[640px] absolute top-0 bottom-0 m-[auto_0]">
                <div class="absolute left-0 top-0 bottom-0 right-0">
                    <div class="min-w-full min-h-[6.25%] flex justify-center items-center">
                        <h3 class="font-bold text-lg select-none">Thumby Arcade</h3>
                    </div>
                    <div class="bg-base-200 min-w-full min-h-[81.25%] max-h-[81.25%] flex overflow-hidden relative">
                        <div id="divGameScrollContainer" class="min-w-full min-h-full flex overflow-y-hidden overflow-x-scroll snap-x snap-mandatory">

                            <div id="divGameList" class="min-w-fit min-h-full flex pr-32 items-center justify-left">
                            </div>

                        </div>

                        <label id="gameCount" class="absolute right-1 top-1 select-none">0/0</label> 

                        <div id="btnScrollLeft" class="absolute top-0 bottom-0 left-0 min-w-fit flex items-center justify-center">
                            <button class="mb-[24px]">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5" />
                                </svg>                              
                            </button>
                        </div>
                        <div id="btnScrollRight" class="absolute top-0 bottom-0 right-0 min-w-fit flex items-center justify-center">
                            <button class="mb-[24px]">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
                                </svg>                             
                            </button>
                        </div>
                        <div class="absolute h-20 bottom-8 left-0 right-0 flex items-center justify-evenly">
                            <button class="btn btn-lg">Info</button>
                            <button id="btnPlay" class="btn btn-lg btn-primary">Play</button>
                        </div>
                    </div>
                    <div class="min-w-full min-h-[12.5%] flex justify-center items-center">
                        <label id="btnBackToGame" for="my-modal" class="tiny:btn tiny:btn-sm  sm:btn sm:btn-lg">Exit</label> 
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script type="application/javascript">
    </script>
</body>
</html>
